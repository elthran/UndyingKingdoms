{% extends "gameplay/layout.html" %}
{% block content2 %}

{% set user = current_user %}
{% set county = current_user.county %}
{% set kingdom = county.kingdom %}

<br><br><br><br>
<h2>Current Attack Power Available: {{ county.get_offensive_strength(county=county) }}</h2>
<h2>Current Defensive Power: {{ county.get_defensive_strength() }}</h2>
<h2>Current Resources:
    {{ county.gold }} <img class="resource_icons" src="/static/images/gold_icon.jpg">
    {{ county.wood }} <img class="resource_icons" src="/static/images/wood_icon.jpg">
    {{ county.iron }} <img class="resource_icons" src="/static/images/iron_icon.jpg">
</h2>
<h2>{{ county.get_available_workers() }} workers available for training</h2>
<form method="POST" accept-charset="UTF-8" role="form">
    {{ form.csrf_token }}
    <table class="production_table">
        <tr>
            <th>Name</th>
            <th>Available</th>
            <th>In Foreign Lands</th>
            <th>Train</th>
            <th style="width:125px;">Cost</th>
            <th>Currently In Training</th>
            <th><div class="tooltip">Attack<span class="tooltipText">{{ meta_data["attack"] }}</span></div></th>
            <th><div class="tooltip">Defence<span class="tooltipText">{{ meta_data["defence"] }}</span></div></th>
            <th><div class="tooltip">Health<span class="tooltipText">{{ meta_data["health"] }}</span></div></th>
            <th>Description</th>
        </tr>
        {% for army in county.armies.values() %}
        <tr>
            <td>{{ army.class_name.title() }}</td>
            <td>{{ army.available }}</td>
            <td>{{ army.traveling }}</td>
            <td>
                <input id="{{ army.base_name }}_slider"
                       type="range" value="0" min="0" max="25" step="1" />
                <input id="{{ army.base_name }}_display" name="{{ army.base_name }}" value="0" />
            </td>
            <td>
                {% if army.gold %}{{ army.gold }}<img class="resource_icons" src="/static/images/gold_icon.jpg">{% endif %}
                {% if army.wood %}{{ army.wood }}<img class="resource_icons" src="/static/images/wood_icon.jpg">{% endif %}
                {% if army.iron %}{{ army.iron }}<img class="resource_icons" src="/static/images/iron_icon.jpg">{% endif %}
                {% if army.gold == 0 and army.wood == 0 and army.iron == 0 %}Free{% endif %}
            </td>
            <td>{{ army.currently_training }}</td>
            <td>{{ army.attack }}</td>
            <td>{{ army.defence }}</td>
            <td>{{ army.health }}</td>
            <td>{{ army.description }}</td>
        </tr>
        {% endfor %}
        <tr>
            <td>Total</td>
            <td>{{ county.get_army_size() }}</td>
            <td>-</td>
            <td>-</td>
            <td></td>
            <td>-</td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
    </table>
    <br><button type="submit">Build</button>
</form>

<h2>Expeditions:</h2>
{% for expedition in county.get_expeditions() %}
{{ expedition.peasant + expedition.archer + expedition.soldier + expedition.elite }} troops will return in {{ expedition.duration }} days.
{% endfor %}

<script type="text/javascript">
{% for army in county.armies.values() %}
    var {{ army.base_name }}_slider = document.getElementById('{{ army.base_name }}_slider'),
    {{ army.base_name }}_display = document.getElementById('{{ army.base_name }}_display');
    {{ army.base_name }}_slider.onchange = function() {
        {{ army.base_name }}_display.value = this.value;
        if (this.value > 0) {
            button.disabled = false;
        }
    }
{% endfor %}
button = document.getElementById('submit');
</script>

{% endblock %}